[[plugins]]
repo = 'Shougo/dein.vim'

# 文字を囲む
[[plugins]]
repo = 'tpope/vim-surround'

# [[plugins]]
# repo = 'Shougo/denite.nvim'
# hook_add = '''
#   source ~/.config/nvim/plugins/denite.vim
# '''

[[plugins]]
repo = 'osyo-manga/vim-anzu'
hook_add = '''
  source ~/.config/nvim/plugins/anzu.vim
'''

[[plugins]]
repo = 'preservim/nerdtree'
hook_add = '''
  source ~/.config/nvim/plugins/nerdtree.vim
'''

# Linter
[[plugins]]
repo = 'w0rp/ale'
hook_add = '''
  source ~/.config/nvim/plugins/ale.vim
'''

# [{の終了タグを保管する
[[plugins]]
repo = 'Townk/vim-autoclose'

# あいまい検索
[[plugins]]
repo = 'junegunn/fzf'
build = './install --bin'
merged = '0'

# あいまい検索
[[plugins]]
repo = 'junegunn/fzf.vim'
depends = 'fzf'
hook_add = '''
  source ~/.config/nvim/plugins/fzf.vim
'''

# マルチカーソル（vim-visual-multi） - IntelliJ風
[[plugins]]
repo = 'mg979/vim-visual-multi'
hook_add = '''
  " 設定はinit.vimで実施済み
'''

# ========================================
# 推奨追加プラグイン
# ========================================

# CoC（Conqueror of Completion）- LSP統合
[[plugins]]
repo = 'neoclide/coc.nvim'
rev = 'release'
hook_add = '''
  " CoCの基本設定
  set updatetime=300
  set signcolumn=yes

  " Tab で補完を選択
  inoremap <silent><expr> <TAB>
        \ coc#pum#visible() ? coc#pum#next(1) :
        \ CheckBackspace() ? "\<Tab>" :
        \ coc#refresh()
  inoremap <expr><S-TAB> coc#pum#visible() ? coc#pum#prev(1) : "\<C-h>"

  " Enterで補完を確定
  inoremap <silent><expr> <CR> coc#pum#visible() ? coc#pum#confirm()
                              \: "\<C-g>u\<CR>\<c-r>=coc#on_enter()\<CR>"

  function! CheckBackspace() abort
    let col = col('.') - 1
    return !col || getline('.')[col - 1]  =~# '\s'
  endfunction

  " 定義ジャンプ
  nmap <silent> gd <Plug>(coc-definition)
  nmap <silent> gy <Plug>(coc-type-definition)
  nmap <silent> gi <Plug>(coc-implementation)
  nmap <silent> gr <Plug>(coc-references)

  " リネーム
  nmap <leader>rn <Plug>(coc-rename)

  " ドキュメント表示
  nnoremap <silent> K :call ShowDocumentation()<CR>
  function! ShowDocumentation()
    if CocAction('hasProvider', 'hover')
      call CocActionAsync('doHover')
    else
      call feedkeys('K', 'in')
    endif
  endfunction

  " コードアクション
  nmap <leader>ca <Plug>(coc-codeaction)

  " フォーマット
  nmap <leader>f :call CocAction('format')<CR>

  " 診断情報の移動
  nmap <silent> [g <Plug>(coc-diagnostic-prev)
  nmap <silent> ]g <Plug>(coc-diagnostic-next)

  " CoCエクステンションの自動インストールリスト
  let g:coc_global_extensions = [
        \ 'coc-tsserver',
        \ 'coc-json',
        \ 'coc-html',
        \ 'coc-css',
        \ 'coc-yaml',
        \ 'coc-prettier',
        \ 'coc-eslint',
        \ 'coc-snippets',
        \ 'coc-go',
        \ 'coc-rust-analyzer',
        \ ]
'''

# Git統合
[[plugins]]
repo = 'tpope/vim-fugitive'
hook_add = '''
  " Git status
  nnoremap <leader>gs :Git<CR>
  " Git blame
  nnoremap <leader>gb :Git blame<CR>
  " Git diff
  nnoremap <leader>gd :Gdiffsplit<CR>
  " Git commit
  nnoremap <leader>gc :Git commit<CR>
  " Git push
  nnoremap <leader>gp :Git push<CR>
  " Git pull
  nnoremap <leader>gP :Git pull<CR>
  " Git log
  nnoremap <leader>gl :Git log<CR>
'''

# コメント補助
[[plugins]]
repo = 'tpope/vim-commentary'
hook_add = '''
  " gcc で行コメントトグル
  " gc{motion} でモーションの範囲をコメントトグル
  " ビジュアルモードで gc でコメントトグル
  autocmd FileType go setlocal commentstring=//\ %s
  autocmd FileType python setlocal commentstring=#\ %s
'''

# Gruvbox カラースキーム - 確実に動作するバックアップ
[[plugins]]
repo = 'morhetz/gruvbox'
hook_add = '''
  let g:gruvbox_contrast_dark = 'medium'
  let g:gruvbox_italic = 1
'''

# Kanagawa カラースキーム - 和風テーマ
[[plugins]]
repo = 'rebelot/kanagawa.nvim'
hook_add = '''
  " termguicolorsを確実に有効化
  if has('termguicolors')
    set termguicolors
  endif
'''
hook_post_source = '''
  " Kanagawaを読み込む前にシンタックスを有効化
  syntax on

  " Kanagawaカラースキームを設定
  try
    colorscheme kanagawa
  catch
    " Kanagawaが読み込めない場合はデフォルトカラースキームを使用
    colorscheme desert
  endtry

  " シンタックスを再度有効化（カラースキーム読み込み後）
  syntax on

  " Elixir固有のシンタックスグループのハイライトを設定
  augroup ElixirSyntaxHighlight
    autocmd!
    autocmd FileType elixir,eelixir highlight link elixirModuleDefine Keyword
    autocmd FileType elixir,eelixir highlight link elixirDefine Keyword
    autocmd FileType elixir,eelixir highlight link elixirPrivateDefine Keyword
    autocmd FileType elixir,eelixir highlight link elixirKeyword Keyword
    autocmd FileType elixir,eelixir highlight link elixirAtom Constant
    autocmd FileType elixir,eelixir highlight link elixirString String
    autocmd FileType elixir,eelixir highlight link elixirStringDelimiter String
    autocmd FileType elixir,eelixir highlight link elixirInterpolation Special
    autocmd FileType elixir,eelixir highlight link elixirInterpolationDelimiter Special
    autocmd FileType elixir,eelixir highlight link elixirDocString Comment
    autocmd FileType elixir,eelixir highlight link elixirAlias Type
    autocmd FileType elixir,eelixir highlight link elixirModule Type
  augroup END
'''

# Airline ステータスライン
[[plugins]]
repo = 'vim-airline/vim-airline'
hook_add = '''
  let g:airline#extensions#tabline#enabled = 1
  let g:airline#extensions#tabline#formatter = 'unique_tail'
  let g:airline_powerline_fonts = 1
  let g:airline#extensions#coc#enabled = 1
  let airline#extensions#coc#error_symbol = '✗:'
  let airline#extensions#coc#warning_symbol = '⚠:'
'''

[[plugins]]
repo = 'vim-airline/vim-airline-themes'
hook_add = '''
  let g:airline_theme='base16_gruvbox_dark_hard'
'''

# Rainbow Parentheses 括弧の色分け
[[plugins]]
repo = 'junegunn/rainbow_parentheses.vim'
hook_add = '''
  let g:rainbow#max_level = 16
  let g:rainbow#pairs = [['(', ')'], ['[', ']'], ['{', '}']]
'''
hook_post_source = '''
  " RainbowParenthesesコマンドが存在する場合のみ実行
  if exists(':RainbowParentheses')
    RainbowParentheses
  endif
'''

# Floaterm フローティングターミナル
[[plugins]]
repo = 'voldikss/vim-floaterm'
hook_add = '''
  " <Leader>t でターミナルトグル
  nnoremap <silent> <leader>t :FloatermToggle<CR>
  tnoremap <silent> <leader>t <C-\><C-n>:FloatermToggle<CR>

  " サイズ設定
  let g:floaterm_width = 0.8
  let g:floaterm_height = 0.8
  let g:floaterm_position = 'center'
  let g:floaterm_borderchars = '─│─│╭╮╯╰'

  " 新しいFloatermを開く
  nnoremap <silent> <leader>tn :FloatermNew<CR>

  " 次/前のFloatermに切り替え
  nnoremap <silent> <leader>tj :FloatermNext<CR>
  nnoremap <silent> <leader>tk :FloatermPrev<CR>
'''

# Markdown プレビュー
[[plugins]]
repo = 'iamcco/markdown-preview.nvim'
build = 'cd app && yarn install'
on_ft = ['markdown']
hook_add = '''
  " <Leader>md でプレビュー
  nmap <leader>md <Plug>MarkdownPreviewToggle

  " プレビューの設定
  let g:mkdp_auto_start = 0
  let g:mkdp_auto_close = 1
  let g:mkdp_refresh_slow = 0
  let g:mkdp_browser = ''
  let g:mkdp_echo_preview_url = 1
'''

# Startify スタート画面とセッション管理
[[plugins]]
repo = 'mhinz/vim-startify'
hook_add = '''
  " セッション保存ディレクトリ
  let g:startify_session_dir = '~/.config/nvim/session'

  " 最近使ったファイルの数
  let g:startify_files_number = 10

  " ブックマーク
  let g:startify_bookmarks = [
        \ {'c': '~/.config/nvim/init.vim'},
        \ {'z': '~/.zshrc'},
        \ {'f': '~/.config/fish/config.fish'},
        \ ]

  " カスタムヘッダー
  let g:startify_custom_header = [
        \ '   ███╗   ██╗███████╗ ██████╗ ██╗   ██╗██╗███╗   ███╗',
        \ '   ████╗  ██║██╔════╝██╔═══██╗██║   ██║██║████╗ ████║',
        \ '   ██╔██╗ ██║█████╗  ██║   ██║██║   ██║██║██╔████╔██║',
        \ '   ██║╚██╗██║██╔══╝  ██║   ██║╚██╗ ██╔╝██║██║╚██╔╝██║',
        \ '   ██║ ╚████║███████╗╚██████╔╝ ╚████╔╝ ██║██║ ╚═╝ ██║',
        \ '   ╚═╝  ╚═══╝╚══════╝ ╚═════╝   ╚═══╝  ╚═╝╚═╝     ╚═╝',
        \ '',
        \ ]
'''

# ========================================
# Elixir / Phoenix サポート
# ========================================

# Elixir 基本シンタックス
[[plugins]]
repo = 'elixir-editors/vim-elixir'
# 遅延ロードを無効化してシンタックスを確実に読み込む
hook_add = '''
  " Elixirシンタックスハイライト設定
  let g:elixir_maxmatchprio = 10
  let g:elixir_indent_max_lookbehind = 30

  " より詳細なシンタックスハイライトを有効化
  let g:elixir_use_markdown_for_docs = 1
'''
hook_post_source = '''
  " Elixir追加ハイライト
  augroup ElixirEnhancedHighlight
    autocmd!
    autocmd FileType elixir,eelixir syn match elixirFunctionCall /\<\h\w*\ze(/
    autocmd FileType elixir,eelixir syn match elixirModuleName /\<[A-Z]\w*\(\.[A-Z]\w*\)*/
    autocmd FileType elixir,eelixir highlight link elixirFunctionCall Function
    autocmd FileType elixir,eelixir highlight link elixirModuleName Type
  augroup END
'''

# Mix フォーマッター統合
[[plugins]]
repo = 'mhinz/vim-mix-format'
hook_add = '''
  " 保存時に自動フォーマット（Elixirファイルのみ）
  let g:mix_format_on_save = 1
  " フォーマッターのオプション
  let g:mix_format_options = '--check-equivalent'
  " Phoenixテンプレートでもフォーマット実行
  let g:mix_format_silent_errors = 1
'''

# Phoenix LiveViewテンプレート強化シンタックス
[[plugins]]
repo = 'mmorearty/elixir-ctags'
hook_add = '''
  " ctagsサポートでElixirの定義ジャンプを改善
'''

# Treesitter - 高度なシンタックスハイライト
[[plugins]]
repo = 'nvim-treesitter/nvim-treesitter'
build = ':TSUpdate'
hook_add = '''
  " Treesitter設定はLuaで記述
'''
hook_post_source = '''
lua << EOF
require('nvim-treesitter.configs').setup {
  -- インストールする言語
  ensure_installed = {
    "elixir",
    "heex",
    "eex",
    "go",
    "rust",
    "typescript",
    "tsx",
    "javascript",
    "html",
    "css",
    "json",
    "yaml",
    "terraform",
    "hcl",
    "markdown"
  },

  -- 自動インストール
  auto_install = true,

  -- シンタックスハイライト
  highlight = {
    enable = true,
    additional_vim_regex_highlighting = false,
  },

  -- インデント
  indent = {
    enable = true,
  },

  -- セマンティックハイライト強化
  incremental_selection = {
    enable = true,
  },
}
EOF
'''

# ========================================
# Go サポート
# ========================================

# Go シンタックス & ツール統合
[[plugins]]
repo = 'fatih/vim-go'
on_ft = ['go']
hook_add = '''
  " GoはCoCとrust-analyzerを使うので、vim-goの重複機能を無効化
  let g:go_def_mapping_enabled = 0
  let g:go_code_completion_enabled = 0
  let g:go_gopls_enabled = 0

  " ハイライト設定
  let g:go_highlight_functions = 1
  let g:go_highlight_methods = 1
  let g:go_highlight_structs = 1
  let g:go_highlight_operators = 1
  let g:go_highlight_build_constraints = 1
  let g:go_highlight_extra_types = 1
  let g:go_highlight_fields = 1
  let g:go_highlight_types = 1
  let g:go_highlight_function_calls = 1
  let g:go_highlight_variable_declarations = 1
  let g:go_highlight_variable_assignments = 1

  " 自動保存時にimportsを整理（CoC経由で実行）
  let g:go_fmt_autosave = 0
  let g:go_imports_autosave = 0
'''

# ========================================
# Rust サポート
# ========================================

# Rust シンタックス
[[plugins]]
repo = 'rust-lang/rust.vim'
on_ft = ['rust']
hook_add = '''
  " rust-analyzerを使うのでrustfmtの自動実行は無効化（CoC経由で実行）
  let g:rustfmt_autosave = 0
  let g:rust_recommended_style = 1
'''

# ========================================
# Terraform サポート
# ========================================

# Terraform シンタックス & LSP
[[plugins]]
repo = 'hashivim/vim-terraform'
on_ft = ['terraform', 'tf', 'hcl']
hook_add = '''
  " 保存時に自動フォーマット
  let g:terraform_fmt_on_save = 1

  " .tf と .tfvars ファイルを認識
  au BufRead,BufNewFile *.tf set filetype=terraform
  au BufRead,BufNewFile *.tfvars set filetype=terraform
  au BufRead,BufNewFile *.hcl set filetype=hcl

  " インデント設定
  let g:terraform_align = 1
'''

# ========================================
# Helm (Kubernetes) サポート
# ========================================

# Helm チャート テンプレート認識
[[plugins]]
repo = 'towolf/vim-helm'
on_ft = ['helm', 'yaml']
hook_add = '''
  " Helmチャートファイルを認識
  au BufRead,BufNewFile */templates/*.yaml set filetype=helm
  au BufRead,BufNewFile */templates/*.tpl set filetype=helm
'''

# ========================================
# TypeScript/React/Next.js サポート
# ========================================

# TypeScript シンタックス拡張
[[plugins]]
repo = 'HerringtonDarkholme/yats.vim'
on_ft = ['typescript', 'typescriptreact']

# JSX/TSX シンタックス
[[plugins]]
repo = 'maxmellon/vim-jsx-pretty'
on_ft = ['javascript', 'javascriptreact', 'typescript', 'typescriptreact']
hook_add = '''
  let g:vim_jsx_pretty_colorful_config = 1
'''

# Styled Components シンタックス
[[plugins]]
repo = 'styled-components/vim-styled-components'
on_ft = ['javascript', 'javascriptreact', 'typescript', 'typescriptreact']

# GraphQL シンタックス（Next.jsでよく使う）
[[plugins]]
repo = 'jparise/vim-graphql'
on_ft = ['graphql', 'javascript', 'javascriptreact', 'typescript', 'typescriptreact']
